<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>A Message for Sonya</title>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>
  <style>
    :root { 
      --yes: #9333ea; 
      --noBg: #f3e8ff; 
      --text: #2e1065; 
      --accent: #c084fc;
    }
    body {
      margin: 0; min-height: 100svh; display: grid; place-items: center;
      background: radial-gradient(circle at center, #2e1065 0%, #0f0720 100%);
      font-family: system-ui, sans-serif; overflow: hidden;
    }

    #startScreen {
      position: fixed; inset: 0; z-index: 9999; display: flex; 
      flex-direction: column; justify-content: center; align-items: center; 
      background: #0f0720; color: white; transition: opacity 0.8s ease;
    }
    .play-btn {
      padding: 18px 45px; background: transparent; color: var(--accent);
      border: 2px solid var(--accent); border-radius: 50px; font-size: 18px; 
      font-weight: bold; cursor: pointer; transition: all 0.3s;
      text-transform: uppercase; letter-spacing: 2px;
    }
    .play-btn:hover { background: var(--accent); color: white; box-shadow: 0 0 30px var(--accent); }

    .card {
      width: min(720px, 92vw); padding: 30px 22px; background: rgba(255,255,255,0.98);
      border-radius: 24px; text-align: center; display: none;
      box-shadow: 0 20px 60px rgba(0,0,0,0.5);
    }
    .collapsible-content { display: grid; grid-template-rows: 0fr; opacity: 0; transition: all 0.7s ease; }
    .collapsible-content.open { grid-template-rows: 1fr; opacity: 1; margin-top: 20px; }
    .inner { overflow: hidden; }
    .art { width: min(260px, 80vw); margin: 0 auto 15px; display: block; border-radius: 15px; }
    h1 { font-size: clamp(26px, 4vw, 42px); margin: 0; color: var(--text); opacity: 0; transition: opacity 0.5s; }

    .button-zone { position: relative; width: 100%; height: 160px; margin-top: 10px; touch-action: none; }
    button {
      position: absolute; top: 50%; transform: translateY(-50%);
      padding: 16px 30px; font-size: 18px; font-weight: 800;
      border-radius: 999px; border: none; cursor: pointer;
    }
    #yesBtn { left: 15%; background: var(--yes); color: #fff; z-index: 10; }
    #noBtn { left: 60%; background: var(--noBg); color: var(--yes); z-index: 100; }
  </style>
</head>
<body>

  <div id="startScreen">
    <p style="margin-bottom: 25px; font-style: italic; opacity: 0.8;">Transmission received from the stars...</p>
    <button class="play-btn" onclick="init()">Open Message</button>
  </div>

  <audio id="trueSong" loop crossorigin="anonymous">
    <source src="https://files.catbox.moe/p88m08.mp3" type="audio/mpeg">
  </audio>

  <main class="card" id="mainCard">
    <h1 id="heading"></h1>
    <div class="collapsible-content" id="stretch">
      <div class="inner">
        <img class="art" src="https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExdWZoM2t6ODd4czc0dXZ5aTY4b3lwdW5yczdrYmx0OThtODhkaDMzNCZlcD12MV9naWZzX3NlYXJjaCZjdD1n/Zl7u48zLVFgLpRwq6f/giphy.gif">
        <section class="button-zone" id="zone">
          <button id="yesBtn">Yes</button>
          <button id="noBtn">No</button>
        </section>
      </div>
    </div>
  </main>

  <script>
    const music = document.getElementById("trueSong");
    
    function init() {
      // Hide screen
      document.getElementById("startScreen").style.opacity = "0";
      setTimeout(() => { document.getElementById("startScreen").style.display = "none"; }, 800);
      document.getElementById("mainCard").style.display = "block";
      
      // Attempt play with volume ramp
      music.volume = 0;
      music.play().then(() => {
        // Smoothly fade in volume so it's not jarring
        let vol = 0;
        let interval = setInterval(() => {
          if (vol < 0.5) {
            vol += 0.05;
            music.volume = vol;
          } else {
            clearInterval(interval);
          }
        }, 100);
      }).catch(err => alert("Please interact with the page first to enable audio!"));
      
      const h1 = document.getElementById("heading");
      h1.innerText = "Hi Sonya,";
      h1.style.opacity = 1;
      
      setTimeout(() => {
        h1.style.opacity = 0;
        setTimeout(() => {
          h1.innerText = "Will you be my Valentine?";
          h1.style.opacity = 1;
          document.getElementById("stretch").classList.add('open');
        }, 600);
      }, 1800);
    }

    // Runaway button code
    const noBtn = document.getElementById("noBtn");
    const yesBtn = document.getElementById("yesBtn");
    const zone = document.getElementById("zone");
    let yesScale = 1;

    function moveNo(px, py) {
      const z = zone.getBoundingClientRect();
      const b = noBtn.getBoundingClientRect();
      let dx = (b.left + b.width / 2) - px;
      let dy = (b.top + b.height / 2) - py;
      let mag = Math.hypot(dx, dy) || 1;
      noBtn.style.left = Math.max(0, Math.min(z.width - b.width, (b.left - z.left) + (dx / mag) * 160)) + "px";
      noBtn.style.top = Math.max(0, Math.min(z.height - b.height, (b.top - z.top) + (dy / mag) * 160)) + "px";
      yesScale = Math.min(2.8, yesScale + 0.15);
      yesBtn.style.transform = `translateY(-50%) scale(${yesScale})`;
    }

    zone.addEventListener("pointermove", e => {
      const b = noBtn.getBoundingClientRect();
      if (Math.hypot((b.left + b.width / 2) - e.clientX, (b.top + b.height / 2) - e.clientY) < 130) moveNo(e.clientX, e.clientY);
    });

    yesBtn.onclick = () => {
       document.getElementById("mainCard").innerHTML = "<h2 style='color:var(--yes); font-size: 32px;'>I know this much is true... ðŸ’œ</h2><img src='https://media.giphy.com/media/lYjA4tfvCc8UAju1Op/giphy.gif' style='width:100%'>";
       confetti({ particleCount: 250, spread: 80 });
    };
  </script>
</body>
</html>
